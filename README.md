# Симулятор нефтяного месторождения

Высокопроизводительный симулятор для моделирования многофазной фильтрации в пористой среде с использованием Python и PyTorch.

## Цель

Создать open-source альтернативу коммерческим продуктам для гидродинамического моделирования.

## Математическая модель

В основе симулятора лежит решение системы дифференциальных уравнений в частных производных, описывающих течение двух несжимаемых флюидов (нефти и воды) в пористой среде.

### Основные уравнения

1.  **Уравнение неразрывности (для каждой фазы $ \alpha $):**
    $$
    \phi \frac{\partial S_\alpha}{\partial t} + \nabla \cdot \vec{u}_\alpha = q_\alpha
    $$
    где:
    - $ \phi $ — пористость,
    - $ S_\alpha $ — насыщенность фазы $ \alpha $,
    - $ \vec{u}_\alpha $ — скорость фильтрации фазы $ \alpha $,
    - $ q_\alpha $ — источники/стоки (скважины).

2.  **Закон Дарси (для каждой фазы $ \alpha $):**
    $$
    \vec{u}_\alpha = - \frac{K k_{r\alpha}}{\mu_\alpha} (\nabla P - \rho_\alpha \vec{g})
    $$
    где:
    - $ K $ — абсолютная проницаемость,
    - $ k_{r\alpha} $ — относительная фазовая проницаемость (в текущей версии упрощенно принята равной 1),
    - $ \mu_\alpha $ — вязкость фазы,
    - $ P $ — давление,
    - $ \rho_\alpha $ — плотность фазы,
    - $ \vec{g} $ — ускорение свободного падения.

### Численная схема: IMPES

Для решения этой системы мы используем стандартный для индустрии метод **IMPES (Implicit Pressure, Explicit Saturation)**.

1.  **Неявное уравнение для давления:** На каждом временном шаге мы решаем уравнение для давления, полученное суммированием уравнений для обеих фаз. Это приводит к большой системе линейных алгебраических уравнений (СЛАУ) вида:
    $$
    \mathbf{A} \mathbf{P}^{n+1} = \mathbf{Q}
    $$
    Решение этой системы неявным образом гарантирует устойчивость расчета. В нашем симуляторе СЛАУ решается итерационным методом сопряженных градиентов.

2.  **Явное уравнение для насыщенности:** После нахождения поля давлений $ P^{n+1} $, мы вычисляем скорости потоков и явно находим насыщенность на новом временном слое:
    $$
    S_w^{n+1} = S_w^n - \frac{\Delta t}{\phi} \nabla \cdot \vec{u}_w(P^{n+1})
    $$
    Для устойчивости расчета потоков используется схема "против потока" (upwind).

## Визуализация результатов

По завершении симуляции создается файл `final_results.png`, содержащий две карты для центрального среза пласта:

1.  **Карта давлений (слева):**
    -   Изображает итоговое распределение давления в мегапаскалях (МПа).
    -   Цветовая схема `jet` помогает визуализировать зоны: синие области соответствуют низкому давлению (вокруг добывающих скважин), а красные — высокому (вокруг нагнетательных).

2.  **Карта насыщенности водой (справа):**
    -   Показывает долю порового объема, занятую водой (от 0 до 1).
    -   Цветовая схема `viridis` наглядно демонстрирует фронт вытеснения: желто-зеленые цвета показывают распространение нагнетаемой воды, а темно-синие — зоны, все еще насыщенные нефтью.

## План развития
-   [ ] Учет относительных фазовых проницаемостей (ОФП)
-   [ ] Векторизация и перенос вычислений на GPU
-   [ ] Усложнение моделей скважин и граничных условий