# Интерактивная 3D визуализация результатов

Симулятор поддерживает создание интерактивных 3D визуализаций через Plotly, которые позволяют визуализировать весь объём резервуара, а не только 2D срезы.

## Быстрый старт

Добавьте в конфигурационный файл:

```json
{
  "save_plotly_3d": true,
  "simulation": {
    "save_interval": 10
  }
}
```

После завершения симуляции в директории результатов будут созданы HTML файлы:
- `*_3d_volume.html` — объёмная визуализация с изоповерхностями
- `*_3d_slices.html` — интерактивный просмотрщик срезов
- `*_3d_animation.html` — анимация (если есть несколько кадров)

Откройте любой из них в браузере для интерактивного просмотра.

## Типы визуализаций

### 1. Объёмная визуализация (`*_3d_volume.html`)

Показывает изоповерхности (поверхности постоянного значения) для:
- **Давления** (красная/жёлтая палитра Jet)
- **Водонасыщенности** (зелёная/синяя палитра Viridis)
- **Газонасыщенности** (фиолетовая/жёлтая палитра Plasma, если есть)

Изоповерхности можно вращать, масштабировать, скрывать/показывать отдельные слои. Также отображается срез по середине Z-оси.

### 2. Просмотрщик срезов (`*_3d_slices.html`)

Три параллельных графика (давление, Sw, Sg) с возможностью изменения Z-среза через слайдер. Удобно для детального анализа конкретных слоёв.

### 3. Анимация (`*_3d_animation*.html`)

Анимированная последовательность изоповерхностей по шагам симуляции. Управление через кнопки ▶/⏸. Создаётся только если есть несколько промежуточных кадров (`save_interval < num_steps`).

## Производительность

Для больших сеток (>500k ячеек) автоматически применяется разреженная выборка (subsampling) для сохранения интерактивности. Это не влияет на точность расчётов, только на визуализацию.

## Пример использования

```bash
# Запуск с 3D визуализацией
python src/main.py --config configs/mega_3phase_million.json

# В конфиге должно быть:
# {
#   "save_plotly_3d": true,
#   "save_vtk": true,  # опционально, для ParaView
#   ...
# }
```

После завершения откройте `results/*/simulation_output_3d_volume.html` в браузере.

## Совместимость

- Требуется `plotly>=5.0.0` (устанавливается через `requirements.txt`)
- HTML файлы работают в любом современном браузере
- Для офлайн-просмотра используйте `include_plotlyjs='inline'` (увеличивает размер файла, но не требует интернета)

## Альтернатива: ParaView

Если предпочитаете ParaView, используйте `save_vtk: true` или `save_vtk_intermediate: true`. VTK файлы (`.vtr`) можно открыть в ParaView для профессиональной визуализации с дополнительными возможностями (сечения, векторы потоков, изоповерхности с настраиваемыми порогами).

