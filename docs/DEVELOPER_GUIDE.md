## Руководство разработчика

### Структура кода
- `src/simulator/`: пласт, флюиды, сборка невязки, шаги по времени, логи.
- `src/solver/`: JFNK (FGMRES), CPR, AMG, нормализация.
- `bench/bench.py`: CLI, запуск бенчмарков.

### Точки расширения
- Новые законы флюидов/PVT: `fluid.py` (функции плотности/вязкости, Rs/Rv, Bo/Bg/Bw).
- Доп. предобуславливатели: `cpr.py` (варианты S‑сглаживания), `geo_solver_v2.py` (сглаживатели/хвосты).
- Новые метрики/логи: добавляйте события в `simulation.py` (JSONL) и цветной вывод.

### Диагностика
- Включить подробные логи AMG: `OIL_DEBUG=1`.
- `[diag F]` включается `sim_params.debug_diag_f=true`.
- JSONL‑события: `newton_iter`, `gmres_done`, `ls_try`, `ls_accept`, `step_summary`.

### Качество и ленты
- Проверяйте vol/mass err; избегайте `.to_dense()` на больших размерах.
- Санитизация NaN/Inf: `torch.nan_to_num` в критических местах.



