# Руководство по вкладу

## 1. Подготовка окружения

1. Форкните репозиторий.
2. Создайте ветку `feature/<topic>` или `bugfix/<topic>`.
3. Настройте окружение по [инструкции](INSTALLATION.md) и установите проект в editable-режиме:
   ```bash
   pip install -e .
   ```

## 2. Стиль кода

- Python ≥ 3.10, придерживаемся PEP 8.
- Используем `ruff` / `flake8` (при наличии) и `black` с ограничением 120 символов (рекомендация, не enforced).
- Типизация: для новых модулей обязательны type hints. В существующих — постепенно расширяем покрытие.

## 3. Проверка качества

Перед пушем:

```bash
pytest
pytest tests/test_amg_pressure_solver.py -k classical_amg_quality
python -m compileall src
```

На больших ветках дополнительно запускайте smoke-тест `configs/medium_2d.json`.

## 4. Документация

- Обновляйте соответствующие разделы в `docs/`.
- Если меняется структура файлов или конфиги — обновите [Архитектуру](ARCHITECTURE.md) и [Краткий старт](QUICKSTART.md).
- При добавлении математических методик или новых моделей — расширяйте [MATHEMATICS.md] и [PHYSICS_MODELS.md].

## 5. Коммиты

- Сообщения в стиле `feat: ...`, `fix: ...`, `docs: ...`.
- Один коммит — одна логическая единица.
- Избегайте «форматирование + функционал» в одном коммите.

## 6. Pull Request

- В PR описывайте:
  - цель изменений;
  - затронутые файлы;
  - результаты тестов;
  - влияние на производительность (если есть).
- Обязательно приложите ссылки на релевантные секции документации (или обновите их).

## 7. Code Review

- Проверяйте стабильность AMG (`grad_rel`, отрицательные веса).
- Следите за управлением памятью на GPU.
- Убедитесь, что новые конфигурации имеют разумные параметры (theta, tol, max_cycles).

## 8. Публикация релизов

- Обновите [CHANGELOG](CHANGELOG.md).
- Сгенерируйте документацию (`mkdocs build` и `python scripts/export_pdf.py`).
- Тегируйте релизы вида `vYYYY.MM.DD`.

## 9. Безопасность

- Конфиденциальные данные в репозитории не храним.
- Проверяйте исходные данные (PVT, конфиги) на корректность перед публикацией.

## 10. Каналы связи

- Issues: баги, запросы на фичи.
- Discussions/Slack (если есть) — вопросы по физике и алгоритмам.

